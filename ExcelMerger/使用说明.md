# Excel文件合并工具使用说明

## 功能特点

- 🔄 **智能列匹配**：自动识别和匹配相同的列名
- 📊 **多种合并模式**：支持只保留共同列或保留所有列
- 📝 **详细分析报告**：显示每个文件的列名分析
- 🏷️ **源文件标记**：自动添加源文件信息列
- ⚡ **批量处理**：一次性合并多个Excel文件

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

### 基本用法

```bash
# 合并多个Excel文件（只保留共同列）
python excel_merger.py file1.xlsx file2.xlsx file3.xlsx

# 指定输出文件名
python excel_merger.py -o 合并结果.xlsx file1.xlsx file2.xlsx

# 保留所有列（包括不同文件的独有列）
python excel_merger.py -m all file1.xlsx file2.xlsx
```

### 高级用法

```bash
# 只分析列名，不进行合并
python excel_merger.py --analyze-only file1.xlsx file2.xlsx

# 使用通配符合并当前目录下所有Excel文件
python excel_merger.py "*.xlsx"

# 合并指定目录下的文件
python excel_merger.py "data/*.xlsx"

# 合并多个模式的文件
python excel_merger.py "*.xlsx" "data/*.xls"
```

## 参数说明

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `files` | 要合并的Excel文件路径（必需） | - |
| `-o, --output` | 输出文件名 | `merged_excel.xlsx` |
| `-m, --mode` | 合并模式：`common`或`all` | `common` |
| `--analyze-only` | 只分析列名，不合并 | `False` |

## 合并模式说明

### common模式（默认）
- 只保留所有文件都有的共同列名
- 适用于结构相似的文件合并
- 确保合并后的数据结构一致

### all模式
- 保留所有文件的所有列名
- 缺失的列会用NaN填充
- 适用于需要保留完整信息的场景

## 使用示例

### 示例1：合并销售数据

假设有以下文件：
- `2023年销售.xlsx`：包含列 [日期, 产品, 销量, 金额]
- `2024年销售.xlsx`：包含列 [日期, 产品, 销量, 金额, 客户]

```bash
# 只保留共同列
python excel_merger.py 2023年销售.xlsx 2024年销售.xlsx
# 结果包含：日期, 产品, 销量, 金额, 源文件

# 保留所有列
python excel_merger.py -m all 2023年销售.xlsx 2024年销售.xlsx
# 结果包含：日期, 产品, 销量, 金额, 客户, 源文件
```

### 示例2：分析文件结构

```bash
python excel_merger.py --analyze-only *.xlsx
```

输出示例：
```
=== 列名分析 ===

文件 1: 2023年销售.xlsx
列名: ['日期', '产品', '销量', '金额']

文件 2: 2024年销售.xlsx
列名: ['日期', '产品', '销量', '金额', '客户']

共同列名 (4 个):
['日期', '产品', '销量', '金额']

文件 2 独有列名: ['客户']
```

## 注意事项

1. **文件格式**：支持 `.xlsx` 和 `.xls` 格式
2. **列名匹配**：列名必须完全相同才会被识别为共同列
3. **列顺序保持**：合并后的列顺序以第一个文件为准
4. **通配符使用**：在Windows命令行中使用通配符时需要加引号，如 `"*.xlsx"`
5. **数据类型**：合并时会自动处理数据类型转换
6. **内存使用**：大文件合并时注意内存使用情况
7. **备份建议**：合并前建议备份原始文件

## 错误处理

- 文件不存在：会显示具体的错误文件路径
- 文件格式错误：会提示无法读取的文件
- 没有共同列：在common模式下会给出建议使用all模式

## 输出信息

工具会显示：
- 每个文件的加载状态和基本信息
- 详细的列名分析结果
- 合并进度和最终统计信息